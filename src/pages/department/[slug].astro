---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
  const departments = await getCollection("departments");
  return departments.map((dept) => ({
    params: { slug: dept.data.slug },
    props: { department: dept },
  }));
}

const { department } = Astro.props;
const { Content } = await render(department);

const departmentName = department.data.name;
const staff = department.data.staff || [];
const documents = department.data.documents || [];
---

<BaseLayout title={`${departmentName} - Big Pine Paiute Tribe`}>
  <div class="row">
    <div class="col-lg-8">
      <h1>{departmentName}</h1>

      <div class="department-content">
        <Content />
      </div>

      {documents.length > 0 && (
        <div class="mt-4">
          <h3>Documents & Forms</h3>
          <ul class="list-group">
            {documents.map((doc: any) => (
              <li class="list-group-item">
                <a href={doc.url} target="_blank" rel="noopener noreferrer">
                  {doc.title}
                </a>
                {doc.description && <p class="mb-0 text-muted small">{doc.description}</p>}
              </li>
            ))}
          </ul>
        </div>
      )}
    </div>

    <div class="col-lg-4">
      {staff.length > 0 && (
        <div class="pop-section p-4">
          <h3>Staff</h3>
          <ul class="list-group list-group-flush">
            {staff.map((member: any) => (
              <li class="list-group-item">
                <strong>{member.name}</strong>
                {member.title && <br />}
                {member.title && <span class="text-muted">{member.title}</span>}
                {member.email && (
                  <>
                    <br />
                    <a href={`mailto:${member.email}`}>{member.email}</a>
                  </>
                )}
                {member.phone && (
                  <>
                    <br />
                    <span>{member.phone}</span>
                  </>
                )}
              </li>
            ))}
          </ul>
        </div>
      )}

      <div class={`pop-section p-4 ${staff.length > 0 ? 'mt-4' : ''}`}>
        <h3>Contact This Department</h3>
        <p>
          For questions about {departmentName}, please contact the main office or visit our{" "}
          <a href="/contact">contact page</a>.
        </p>
      </div>
    </div>
  </div>
</BaseLayout>
